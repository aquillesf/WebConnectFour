<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - Connect 4</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;400;600&display=swap" rel="stylesheet">
</head>

<body>
    <button class="panel-btn unsadden" id="dark-mode-btn">Modo Escuro</button>

    <div class="admin-container">
        <div class="admin-header">
            <h1>Painel de Administra√ß√£o</h1>
            <p>Gerenciamento do sistema Connect 4</p>
            <button class="admin-btn admin-btn-secondary" id="back-to-game">Voltar ao jogo</button>
        </div>

        <!-- Statistics Section -->
        <div class="admin-section">
            <h2>Estat√≠sticas do Sistema</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-info">
                        <div class="stat-value" id="total-users">0</div>
                        <div class="stat-label">Usu√°rios Online</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚è∏Ô∏è</div>
                    <div class="stat-info">
                        <div class="stat-value" id="inactive-users">0</div>
                        <div class="stat-label">Usu√°rios Inativos</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üéÆ</div>
                    <div class="stat-info">
                        <div class="stat-value" id="queue-size">0</div>
                        <div class="stat-label">Jogadores na Fila</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üèÜ</div>
                    <div class="stat-info">
                        <div class="stat-value" id="total-accounts">0</div>
                        <div class="stat-label">Total de Contas</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Online Users Section -->
        <div class="admin-section">
            <h2>üë§ Usu√°rios Online</h2>
            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Avatar</th>
                            <th>Nome de Usu√°rio</th>
                            <th>Status</th>
                            <th>Tempo Inativo</th>
                            <th>√öltima Atividade</th>
                        </tr>
                    </thead>
                    <tbody id="online-users-table">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Queue Management Section -->
        <div class="admin-section">
            <h2>üéØ Gerenciamento da Fila</h2>
            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Posi√ß√£o</th>
                            <th>Avatar</th>
                            <th>Nome de Usu√°rio</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="queue-table">
                    </tbody>
                </table>
            </div>
            <div class="admin-actions">
                <button class="admin-btn admin-btn-warning" id="clear-queue-btn">Limpar Fila</button>
            </div>
        </div>

        <!-- Delete User Section -->
        <div class="admin-section admin-danger-zone">
            <h2>‚ö†Ô∏è Zona de Perigo</h2>
            <p class="danger-warning">Aten√ß√£o: As a√ß√µes abaixo s√£o irrevers√≠veis!</p>

            <div class="delete-user-form">
                <h3>Deletar Conta de Usu√°rio</h3>
                <div class="form-group">
                    <label for="delete-username">Nome de Usu√°rio</label>
                    <input type="text" id="delete-username" class="admin-input" placeholder="Digite o nome do usu√°rio">
                </div>
                <div class="form-group">
                    <label for="delete-reason">Motivo da Exclus√£o</label>
                    <textarea id="delete-reason" class="admin-input" rows="3"
                        placeholder="Digite o motivo (opcional)"></textarea>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="confirm-delete">
                        Confirmo que desejo deletar esta conta permanentemente
                    </label>
                </div>
                <button class="admin-btn admin-btn-danger" id="delete-user-btn">Deletar Conta</button>
            </div>
        </div>

        <!-- Activity Log -->
        <div class="admin-section">
            <h2>üìù Registro de Atividades</h2>
            <div class="activity-log" id="activity-log">
            </div>
        </div>
    </div>

    <script>
        // Simulate online users with activity tracking
        let onlineUsers = [
            { name: "Jo√£oSilva", avatar: "1", status: "active", lastActivity: Date.now() },
            { name: "MariaSantos", avatar: "2", status: "inactive", lastActivity: Date.now() - 300000 }, // 5 min ago
            { name: "PedroLima", avatar: "3", status: "active", lastActivity: Date.now() },
            { name: "AnaCarla", avatar: "4", status: "inactive", lastActivity: Date.now() - 600000 }, // 10 min ago
            { name: "CarlosReis", avatar: "5", status: "active", lastActivity: Date.now() }
        ];

        let activityLog = [];

        function addLogEntry(message, type = "info") {
            const timestamp = new Date().toLocaleString('pt-BR');
            activityLog.unshift({ message, type, timestamp });
            if (activityLog.length > 20) activityLog.pop();
            updateActivityLog();
        }

        function updateActivityLog() {
            const logContainer = document.getElementById("activity-log");
            if (!logContainer) return;

            if (activityLog.length === 0) {
                logContainer.innerHTML = '<p class="no-activity">Nenhuma atividade registrada ainda.</p>';
                return;
            }

            logContainer.innerHTML = activityLog.map(entry => `
                <div class="log-entry log-${entry.type}">
                    <span class="log-time">${entry.timestamp}</span>
                    <span class="log-message">${entry.message}</span>
                </div>
            `).join("");
        }

        function updateStatistics() {
            const totalUsers = onlineUsers.length;
            const inactiveUsers = onlineUsers.filter(u => u.status === "inactive").length;
            const queueSize = JSON.parse(localStorage.getItem("playerQueue") || "[]").length;
            const leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
            const totalAccounts = leaderboard.length;

            document.getElementById("total-users").textContent = totalUsers;
            document.getElementById("inactive-users").textContent = inactiveUsers;
            document.getElementById("queue-size").textContent = queueSize;
            document.getElementById("total-accounts").textContent = totalAccounts;
        }

        function getInactiveTime(lastActivity) {
            const diff = Date.now() - lastActivity;
            const minutes = Math.floor(diff / 60000);
            const seconds = Math.floor((diff % 60000) / 1000);

            if (minutes > 0) {
                return `${minutes}m ${seconds}s`;
            }
            return `${seconds}s`;
        }

        function formatTime(timestamp) {
            return new Date(timestamp).toLocaleTimeString('pt-BR');
        }

        function updateOnlineUsersTable() {
            const tbody = document.getElementById("online-users-table");
            if (!tbody) return;

            tbody.innerHTML = onlineUsers.map(user => {
                const statusClass = user.status === "active" ? "status-active" : "status-inactive";
                const statusText = user.status === "active" ? "Ativo" : "Inativo";
                const inactiveTime = user.status === "inactive" ? getInactiveTime(user.lastActivity) : "-";

                return `
                    <tr>
                        <td>
                            <div class="user-avatar-small">
                                <img src="Profile Pictures/${user.avatar}.jpg" alt="Avatar">
                            </div>
                        </td>
                        <td>${user.name}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>${inactiveTime}</td>
                        <td>${formatTime(user.lastActivity)}</td>
                    </tr>
                `;
            }).join("");
        }

        function updateQueueTable() {
            const tbody = document.getElementById("queue-table");
            if (!tbody) return;

            const queue = JSON.parse(localStorage.getItem("playerQueue") || "[]");

            if (queue.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data">Nenhum jogador na fila</td></tr>';
                return;
            }

            tbody.innerHTML = queue.map((player, index) => {
                const statusText = player.status === "playing" ? "üéÆ Jogando" : "‚è≥ Aguardando";
                const statusClass = player.status === "playing" ? "status-playing" : "status-waiting";

                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>
                            <div class="user-avatar-small">
                                <img src="Profile Pictures/${player.avatar}.jpg" alt="Avatar">
                            </div>
                        </td>
                        <td>${player.name}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="admin-btn-small admin-btn-danger" onclick="removeFromQueue('${player.name}')">
                                Remover
                            </button>
                        </td>
                    </tr>
                `;
            }).join("");
        }

        function removeFromQueue(username) {
            let queue = JSON.parse(localStorage.getItem("playerQueue") || "[]");
            queue = queue.filter(p => p.name !== username);
            localStorage.setItem("playerQueue", JSON.stringify(queue));
            updateQueueTable();
            updateStatistics();
            addLogEntry(`Usu√°rio ${username} removido da fila pelo administrador`, "warning");
        }

        const clearQueueBtn = document.getElementById("clear-queue-btn");
        if (clearQueueBtn) {
            clearQueueBtn.onclick = function () {
                if (confirm("Tem certeza que deseja limpar toda a fila?")) {
                    localStorage.setItem("playerQueue", "[]");
                    updateQueueTable();
                    updateStatistics();
                    addLogEntry("Fila de jogadores foi limpa pelo administrador", "warning");
                }
            };
        }

        const deleteUserBtn = document.getElementById("delete-user-btn");
        if (deleteUserBtn) {
            deleteUserBtn.onclick = function () {
                const username = document.getElementById("delete-username").value.trim();
                const reason = document.getElementById("delete-reason").value.trim();
                const confirmed = document.getElementById("confirm-delete").checked;

                if (!username) {
                    alert("Por favor, insira o nome do usu√°rio.");
                    return;
                }

                if (!confirmed) {
                    alert("Por favor, confirme a exclus√£o marcando a caixa de sele√ß√£o.");
                    return;
                }

                if (confirm(`Tem certeza absoluta que deseja deletar a conta de ${username}? Esta a√ß√£o N√ÉO pode ser desfeita!`)) {
                    // Remove from leaderboard
                    let leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
                    const userExists = leaderboard.some(p => p.name === username);

                    if (!userExists) {
                        alert(`Usu√°rio ${username} n√£o encontrado no sistema.`);
                        return;
                    }

                    leaderboard = leaderboard.filter(p => p.name !== username);
                    localStorage.setItem("leaderboard", JSON.stringify(leaderboard));

                    // Remove from queue
                    let queue = JSON.parse(localStorage.getItem("playerQueue") || "[]");
                    queue = queue.filter(p => p.name !== username);
                    localStorage.setItem("playerQueue", JSON.stringify(queue));

                    // Remove from online users
                    onlineUsers = onlineUsers.filter(u => u.name !== username);

                    // Clear form
                    document.getElementById("delete-username").value = "";
                    document.getElementById("delete-reason").value = "";
                    document.getElementById("confirm-delete").checked = false;

                    // Update displays
                    updateOnlineUsersTable();
                    updateQueueTable();
                    updateStatistics();

                    const logMessage = reason
                        ? `Conta de ${username} deletada. Motivo: ${reason}`
                        : `Conta de ${username} deletada pelo administrador`;
                    addLogEntry(logMessage, "danger");

                    alert(`Conta de ${username} deletada com sucesso.`);
                }
            };
        }

        const backToGameBtn = document.getElementById("back-to-game");
        if (backToGameBtn) {
            backToGameBtn.onclick = () => {
                window.location.href = "index.html";
            };
        }

        const darkBtn = document.getElementById("dark-mode-btn");
        let darkMode = localStorage.getItem("darkMode") === "true";

        if (darkBtn) {
            if (darkMode) {
                document.body.classList.add("dark");
                darkBtn.textContent = "Modo Claro";
            }

            darkBtn.onclick = function () {
                darkMode = !darkMode;
                document.body.classList.toggle("dark");
                localStorage.setItem("darkMode", darkMode);

                if (darkMode) {
                    darkBtn.textContent = "Modo Claro";
                } else {
                    darkBtn.textContent = "Modo Escuro";
                }
            };
        }

        // Simulate user activity changes
        setInterval(() => {
            onlineUsers.forEach(user => {
                if (Math.random() > 0.7) {
                    user.status = user.status === "active" ? "inactive" : "active";
                    if (user.status === "active") {
                        user.lastActivity = Date.now();
                    }
                }
            });
            updateOnlineUsersTable();
            updateStatistics();
        }, 10000);

        // Update inactive time every second
        setInterval(() => {
            updateOnlineUsersTable();
        }, 1000);

        // Initialize
        updateStatistics();
        updateOnlineUsersTable();
        updateQueueTable();
        addLogEntry("Painel de administra√ß√£o carregado", "info");
    </script>
</body>

</html>